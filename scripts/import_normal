#!/bin/bash

set -euo pipefail
set -x

SRC=../ocaml-benchs/$1
DEST=./normal/$1_benchmark

cp -r "$SRC" "$DEST"

ML_FILE_NAMES=$(find "$DEST" -name "*.ml"  -execdir echo {} ';' | xargs)
MLI_FILE_NAMES=$(find "$DEST" -name "*.mli"  -execdir echo {} ';' | xargs)

cd $(dirname $0)/..
cat Makefile.normal.template \
  | sed -e "s/BINARY_NAME/$1_benchmark/" -e  "s/SOURCE_FILES/$MLI_FILE_NAMES $ML_FILE_NAMES/" \
  >"$DEST"/Makefile

echo "You might need to reorder the files in the generated directory"
echo "  cd $DEST; make all; "
